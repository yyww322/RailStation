<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>仪器设计 by yyww322</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">仪器设计</h1>
      <h2 class="project-tagline">存储相关设计</h2>
      <a href="https://github.com/yyww322/RailStation" class="btn">View on GitHub</a>
      <a href="https://github.com/yyww322/RailStation/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/yyww322/RailStation/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h2>
<a id="使用环境描述" class="anchor" href="#%E4%BD%BF%E7%94%A8%E7%8E%AF%E5%A2%83%E6%8F%8F%E8%BF%B0" aria-hidden="true"><span class="octicon octicon-link"></span></a>使用环境描述</h2>

<p>本设计主要的后台处理系统为windows系列，因此tf卡采用了fat32的存储格式，最终设计是将数据存储入txt文档，并为客户提供相应的将txt文档数据转化为excel文件的工具。
实现分为了两部分，一部分是在仪器上讲数据存储入tf卡，一部分是在电脑中将tf卡中的数据管理，提取，变成客户要求的xls文件。</p>

<h2>
<a id="仪器存储格式设计" class="anchor" href="#%E4%BB%AA%E5%99%A8%E5%AD%98%E5%82%A8%E6%A0%BC%E5%BC%8F%E8%AE%BE%E8%AE%A1" aria-hidden="true"><span class="octicon octicon-link"></span></a>仪器存储格式设计</h2>

<h3>
<a id="1-存储数据类型" class="anchor" href="#1-%E5%AD%98%E5%82%A8%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B" aria-hidden="true"><span class="octicon octicon-link"></span></a>1. 存储数据类型</h3>

<p>目前与客户沟通，所需存储的数据有两类：</p>

<ul>
<li>测试现场属性</li>
<li>实测数据结果</li>
</ul>

<p>测试现场属性包括：</p>

<ul>
<li>车站名称</li>
<li>站台名称</li>
<li>轨道号码</li>
<li>工作日期</li>
<li>检定单位</li>
<li>观测人员</li>
<li>轨道类型</li>
<li>仪器内部修正值</li>
</ul>

<p>实测数据结果包括：</p>

<ul>
<li>铁轨点号</li>
<li>铁轨水平A值</li>
<li>铁轨垂直A值</li>
<li>雨棚点号</li>
<li>雨棚水平A值</li>
<li>雨棚垂直A值</li>
<li>立柱点号</li>
<li>立柱水平A值</li>
</ul>

<h3>
<a id="2-具体实现方式" class="anchor" href="#2-%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F" aria-hidden="true"><span class="octicon octicon-link"></span></a>2. 具体实现方式：</h3>

<p>在磁盘中，按照日期来存储当日所有数据，因此，如果操作人员输入错误日期，有可能会将数据存入别的日期的文件中。
文件中的数据不会互相覆盖，如果已有文件，会一直向文件末尾添加。如果文件不存在，则自动按照日期创建一个新的文件。注意默认的日期为20151201。
如果用户在输入界面修改了测试现场属性，并按下确定存储，会将默认的点号全部变回1（当然，用户可以自行输入点号来改变点号），当接下来的测试点存储到磁盘时，也会在文件中写入现场属性所有信息。现场属性一旦按下确认，就会在内部文件system3.txt内保存现场信息，以便每次开机都能显示上一次输入的属性。</p>

<p>下表是文件内字段对应的现场属性值：</p>

<table>
<thead>
<tr>
<th>属性名称</th>
<th>存储字头</th>
</tr>
</thead>
<tbody>
<tr>
<td>车站名称</td>
<td>Station</td>
</tr>
<tr>
<td>站台名称</td>
<td>Platform</td>
</tr>
<tr>
<td>轨道号码</td>
<td>RailNum</td>
</tr>
<tr>
<td>工作日期</td>
<td>Date</td>
</tr>
<tr>
<td>检定单位</td>
<td>Department</td>
</tr>
<tr>
<td>观测人员</td>
<td>Name</td>
</tr>
<tr>
<td>轨道类型</td>
<td>RailType</td>
</tr>
<tr>
<td>仪器内部修正值</td>
<td>BiasX,BiasY,BiasZ</td>
</tr>
</tbody>
</table>

<p>设置完属性后，即可开始测量数据，当测量完毕，按下存储键后，如果有未保存的现场属性，会在写入测量数据前，先将现场属性数据写入文件，而后是测量数据。</p>

<p>下面是当前设计的数据存储格式：
|类型|存储格式|
|---|---|
|铁轨|rail: 点号 标准值 数据
|雨棚|roof: 点号 标准值 数据
|立柱|pillar: 点号 标准值 数据</p>

<p>考虑到标准值很可能不是一个常数，因此这里设计每一个点都有标准值，如果不人为改变标准值，则只需输入一次，后面的所有点标准值都按照前点的标准值计算。
三种测量的点号互不影响，独立计算。</p>

<h2>
<a id="后台处理程序设计" class="anchor" href="#%E5%90%8E%E5%8F%B0%E5%A4%84%E7%90%86%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1" aria-hidden="true"><span class="octicon octicon-link"></span></a>后台处理程序设计</h2>

<p>考虑到python处理数据方便，程序体积小，目前暂定使用python做为后台处理语言。</p>

<h3>
<a id="1-图形交互界面" class="anchor" href="#1-%E5%9B%BE%E5%BD%A2%E4%BA%A4%E4%BA%92%E7%95%8C%E9%9D%A2" aria-hidden="true"><span class="octicon octicon-link"></span></a>1. 图形交互界面</h3>

<p>使用Tkinter类型成界面，界面内应有可以选择打开仪器采集数据文件的界面。如果有可能还可以设计一个存放Excel模板文件的选择界面，但这个要和用户进行沟通。
选择了文件后将会自动跟据内容生成Excel文件，如果有模板可以依照约定好的方式向模板内填写数据。生成的文件暂时设定存储到约定目录。</p>

<h3>
<a id="2-填写数据方式" class="anchor" href="#2-%E5%A1%AB%E5%86%99%E6%95%B0%E6%8D%AE%E6%96%B9%E5%BC%8F" aria-hidden="true"><span class="octicon octicon-link"></span></a>2. 填写数据方式</h3>

<p>使用xlwt类生成Excel文件，每一次数据文件内有新的现场属性出现，则认为是一次新的输入，则会保存之前的数据，此后创建一组新的Excel文件。
一组Excel文件最多有可能包括3个文件，分别为轨道数据，雨棚数据，立柱数据。
如果本组同类数据内有重复的点号，则后点覆盖前点。
读取到文件末尾，则保存当前一组Excel数据。</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/yyww322/RailStation">仪器设计</a> is maintained by <a href="https://github.com/yyww322">yyww322</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
