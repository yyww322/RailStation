{"name":"仪器设计","tagline":"存储相关设计","body":"##使用环境描述\r\n本设计主要的后台处理系统为windows系列，因此tf卡采用了fat32的存储格式，最终设计是将数据存储入txt文档，并为客户提供相应的将txt文档数据转化为excel文件的工具。\r\n实现分为了两部分，一部分是在仪器上讲数据存储入tf卡，一部分是在电脑中将tf卡中的数据管理，提取，变成客户要求的xls文件。\r\n\r\n##仪器存储格式设计\r\n###1. 存储数据类型\r\n目前与客户沟通，所需存储的数据有两类：\r\n\r\n - 测试现场属性\r\n - 实测数据结果\r\n\r\n测试现场属性包括：\r\n\r\n - 车站名称\r\n - 站台名称\r\n - 轨道号码\r\n - 工作日期\r\n - 检定单位\r\n - 观测人员\r\n - 轨道类型\r\n - 仪器内部修正值\r\n\r\n实测数据结果包括：\r\n\r\n - 铁轨点号\r\n - 铁轨水平A值\r\n - 铁轨垂直A值\r\n - 雨棚点号\r\n - 雨棚水平A值\r\n - 雨棚垂直A值\r\n - 立柱点号\r\n - 立柱水平A值\r\n \r\n###2. 具体实现方式：\r\n在磁盘中，按照日期来存储当日所有数据，因此，如果操作人员输入错误日期，有可能会将数据存入别的日期的文件中。\r\n文件中的数据不会互相覆盖，如果已有文件，会一直向文件末尾添加。如果文件不存在，则自动按照日期创建一个新的文件。注意默认的日期为20151201。\r\n如果用户在输入界面修改了测试现场属性，并按下确定存储，会将默认的点号全部变回1（当然，用户可以自行输入点号来改变点号），当接下来的测试点存储到磁盘时，也会在文件中写入现场属性所有信息。现场属性一旦按下确认，就会在内部文件system3.txt内保存现场信息，以便每次开机都能显示上一次输入的属性。\r\n\r\n下表是文件内字段对应的现场属性值：\r\n\r\n|属性名称|存储字头|\r\n|-------|-------|\r\n|车站名称|Station|\r\n|站台名称|Platform|\r\n|轨道号码|RailNum|\r\n|工作日期|Date|\r\n|检定单位|Department|\r\n|观测人员|Name|\r\n|轨道类型|RailType|\r\n|仪器内部修正值|BiasX,BiasY,BiasZ|\r\n\r\n设置完属性后，即可开始测量数据，当测量完毕，按下存储键后，如果有未保存的现场属性，会在写入测量数据前，先将现场属性数据写入文件，而后是测量数据。\r\n\r\n下面是当前设计的数据存储格式：\r\n|类型|存储格式|\r\n|---|---|\r\n|铁轨|rail: 点号 标准值 数据\r\n|雨棚|roof: 点号 标准值 数据\r\n|立柱|pillar: 点号 标准值 数据\r\n\r\n考虑到标准值很可能不是一个常数，因此这里设计每一个点都有标准值，如果不人为改变标准值，则只需输入一次，后面的所有点标准值都按照前点的标准值计算。\r\n三种测量的点号互不影响，独立计算。\r\n \r\n##后台处理程序设计\r\n考虑到python处理数据方便，程序体积小，目前暂定使用python做为后台处理语言。\r\n###1. 图形交互界面\r\n使用Tkinter类型成界面，界面内应有可以选择打开仪器采集数据文件的界面。如果有可能还可以设计一个存放Excel模板文件的选择界面，但这个要和用户进行沟通。\r\n选择了文件后将会自动跟据内容生成Excel文件，如果有模板可以依照约定好的方式向模板内填写数据。生成的文件暂时设定存储到约定目录。\r\n###2. 填写数据方式\r\n使用xlwt类生成Excel文件，每一次数据文件内有新的现场属性出现，则认为是一次新的输入，则会保存之前的数据，此后创建一组新的Excel文件。\r\n一组Excel文件最多有可能包括3个文件，分别为轨道数据，雨棚数据，立柱数据。\r\n如果本组同类数据内有重复的点号，则后点覆盖前点。\r\n读取到文件末尾，则保存当前一组Excel数据。","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}